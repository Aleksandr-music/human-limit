<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Subjects</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<style>
.block{
  margin:0;
  font-size:14px;
  line-height:26px;
  color:var(--dim);
  white-space:pre-line;
}

/* SUBJECT ROWS: выглядят как текст, но кликабельны */
.subject-row{
  display:block;
  color:var(--dim);
  cursor:pointer;
  text-decoration:none;
  user-select:none;
}
.subject-row:hover{
  color:var(--fg);
  text-decoration:none; /* важно: не как ссылка */
}
.subject-row:focus{
  outline:none;
  color:var(--fg);
}

/* terminal commands */
.cmd{
  color:var(--fg);
  cursor:pointer;
  user-select:none;
}
.cmd:hover{ text-decoration:underline; }
.cmd::before{
  content:"> ";
  color:var(--fg);
}

.hint{
  margin-top:10px;
  color:var(--dim2);
  font-size:13px;
  min-height:18px;
  white-space:pre-line;
}

/* lock UI during lookup */
.is-busy .subject-row,
.is-busy .cmd,
.is-busy .node{
  pointer-events:none;
  opacity:0.7;
}
</style>
</head>

<body data-bg="subjects"> 

<div class="title">SUBJECT DATABASE<span class="cursor">_</span></div>

<div class="block">INDEX STATUS: PARTIAL
ACCESS LEVEL: LIMITED</div>

<div class="spacer-1"></div>

<!-- SUBJECT LIST -->
<a class="subject-row"
   href="subject-alex.html"
   data-target="subject-alex.html"
   data-id="S-001"
   data-name="ALEX"
   data-status="ACTIVE"
   data-access="LIMITED">S-001  ALEX    ACTIVE    LIMITED</a>

<a class="subject-row"
   href="subject-mentor.html"
   data-target="subject-mentor.html"
   data-id="S-002"
   data-name="MENTOR"
   data-status="REDACTED"
   data-access="DENIED">S-002  MENTOR  REDACTED  DENIED</a>

<a class="subject-row"
   href="subject-kiwi.html"
   data-target="subject-kiwi.html"
   data-id="S-003"
   data-name="KIWI"
   data-status="ACTIVE"
   data-access="LIMITED">S-003  KIWI    ACTIVE    LIMITED</a>

<a class="subject-row"
   href="subject-french.html"
   data-target="subject-french.html"
   data-id="S-004"
   data-name="FRENCH"
   data-status="ACTIVE"
   data-access="LIMITED">S-004  FRENCH  ACTIVE    LIMITED</a>

<div class="spacer-2"></div>

<div class="block">QUERY VIA TERMINAL</div>
<div class="cmd" data-cmd="subjects:list">subjects:list</div>
<div class="cmd" data-cmd="subject alex">subject alex</div>
<div class="cmd" data-cmd="subject mentor">subject mentor</div>

<div id="hint" class="hint"></div>

<div class="spacer-2"></div>

<a class="node" href="interface.html">RETURN TO SYSTEM</a>

<script>
(function(){
  const hint = document.getElementById("hint");
  const body = document.body;

  function setBusy(state){
    body.classList.toggle("is-busy", !!state);
  }

  function clearHint(){
    hint.textContent = "";
  }

  function writeLine(line){
    // line может быть "" для пустой строки
    hint.textContent += (line === "" ? "\n" : ("> " + line + "\n"));
  }

  function sleep(ms){
    return new Promise(r => setTimeout(r, ms));
  }

  async function copy(text){
    try{
      await navigator.clipboard.writeText(text);
      hint.textContent = "> COPIED: " + text;
    }catch(e){
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.style.position = "fixed";
      ta.style.opacity = "0";
      document.body.appendChild(ta);
      ta.select();
      try{
        document.execCommand("copy");
        hint.textContent = "> COPIED: " + text;
      }catch(_){
        hint.textContent = "> COPY FAILED";
      }
      document.body.removeChild(ta);
    }
    setTimeout(() => { hint.textContent = ""; }, 1200);
  }

  async function lookupAndGo(opts){
    setBusy(true);
    clearHint();

    const steps = [
      `QUERY: ${opts.id} ${opts.name}`,
      `STATUS: ${opts.status}`,
      `ACCESS: ${opts.access}`,
      "",
      "INDEX: SEARCHING…",
      "TRACE: OPEN NODES…",
      "DECRYPT: STREAM…",
      "OPEN RECORD…"
    ];

    for(let i=0;i<steps.length;i++){
      writeLine(steps[i]);
      await sleep(i < 3 ? 170 : 220);
    }

    await sleep(220);
    window.location.href = opts.target;
  }

  // commands -> copy
  document.querySelectorAll(".cmd").forEach(el => {
    el.addEventListener("click", () => copy(el.dataset.cmd || ""));
  });

  // subject click -> lookup -> redirect
  document.querySelectorAll(".subject-row").forEach(a => {
    // keyboard support (Enter/Space)
    a.setAttribute("role", "button");
    a.setAttribute("tabindex", "0");

    a.addEventListener("click", (e) => {
      e.preventDefault();
      const target = a.dataset.target || a.getAttribute("href");

      lookupAndGo({
        target,
        id: a.dataset.id || "S-???",
        name: a.dataset.name || "UNKNOWN",
        status: a.dataset.status || "UNKNOWN",
        access: a.dataset.access || "UNKNOWN"
      });
    });

    a.addEventListener("keydown", (e) => {
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        a.click();
      }
    });
  });

  // safety: если вернулись назад — снимаем busy
  window.addEventListener("pageshow", () => setBusy(false));
})();
</script>

</body>
</html>